{% extends "base.html" %}

{% block content %}

<h1>Spart 마켓에 오신것을 환영합니다!</h1> 
<br>
{% if request.user.is_authenticated %}

        <a href="{% url 'products:product_creats' %}">
            <button class="btn btn-success">새로운 글 작성</button></a>
    
    {% else  %}
        <a href="{% url 'accounts:login' %}">
            <button class="btn btn-success">
            로그인하고 글 작성하기</button></a>
    
    {% endif %}

<div class="row row-cols-1 row-cols-md-3 g-4">
    


{% for product in products %}

<div class="col">
<div class="card" style="width: 20rem;">
    {% if product.image %}
    <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.image }}">
    {% endif %}
    <div class="card-body">
      <a href="{% url 'products:product_detail' product.pk %}" class="card-title"><h4>{{ product.title }}</h4></a>
      <p class="card-text">{{ product.content }}</p>
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">작성자: {{product.author.username}}</li>
      <li class="list-group-item">가격: {{product.price}}원</li>
    </ul>
    <div class="card-bottom">

        <div class='card-like'>
            <form action="{% url 'products:like' product.pk %}" method="POST">
                {% csrf_token %}
            {% if request.user in product.like_users.all %}
                    <button class="btn btn-link text-danger">
                        <i class="bi bi-heart-fill"></i>
                    </button>
                    
                
            {% else %}
                <button class="btn btn-link text-danger" >
                    <i class="bi bi-heart"></i>
                </button>
            {% endif %}
    
            {{ product.like_users.all|length }}
            </form>
        </div>

        <div class='card-like'>
            조회수: {{ product.hits }}
        </div>
        
        <div class='card-like'>
            댓글수: {{ product.comment_count }}
        </div>
    </div>
  </div>
</div>
  {% endfor %}
    
  </div>
    
    

{% endblock content %}